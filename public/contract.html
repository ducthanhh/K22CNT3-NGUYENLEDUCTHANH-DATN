<h2>Há»¢P Äá»’NG Dá»ŠCH Vá»¤ DU Lá»ŠCH SÃ”NG ÄÃ€</h2>

<pre id="content" style="background:#f5f5f5;padding:15px;white-space:pre-wrap"></pre>

<label>
  <input type="checkbox" id="agree">
  TÃ´i Ä‘á»“ng Ã½ vá»›i cÃ¡c Ä‘iá»u khoáº£n trÃªn
</label>
<br><br>

<button onclick="acceptContract()">XÃ¡c nháº­n & Thanh toÃ¡n</button>

<script>
const params = new URLSearchParams(window.location.search);
const bookingId = params.get('id');

if (!bookingId) {
    alert('KhÃ´ng tÃ¬m tháº¥y booking!');
}

// ğŸ‘‰ Load há»£p Ä‘á»“ng
fetch(`/api/contract/${bookingId}`)
    .then(res => res.json())
    .then(contract => {
        if (!contract) {
            document.getElementById('content').innerText =
                'KhÃ´ng tÃ¬m tháº¥y há»£p Ä‘á»“ng';
            return;
        }
        document.getElementById('content').innerText =
            contract.contract_content;
    });

// ğŸ‘‰ XÃ¡c nháº­n há»£p Ä‘á»“ng
function acceptContract() {
    const agree = document.getElementById('agree').checked;

    if (!agree) {
        alert('Báº¡n pháº£i Ä‘á»“ng Ã½ há»£p Ä‘á»“ng!');
        return;
    }

    fetch('/api/accept-contract', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ booking_id: bookingId })
    })
    .then(res => res.json())
    .then(r => {
        console.log('API response:', r); // ğŸ”¥ DEBUG

        if (r.success) {
            window.location.href = `/payment-page?id=${bookingId}`;
        } else {
            alert('KhÃ´ng thá»ƒ xÃ¡c nháº­n há»£p Ä‘á»“ng!');
        }
    });
}

</script>
